year >= 2017,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns ) %>%
group_by(community, month) %>%
summarise(monthlyav = mean(Q_MGD)) %>%
mutate(year = "17-19") %>%
ungroup() %>%
left_join(Sani_16_18, by = c("community", "month", "year")) %>%
mutate( II_Q = monthlyav - Sani_Q)
ww_FY21_act <- mon_17_19 %>%
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
mutate(FY = "FY21",
actual = T)
###### ESTIMATES #######
#FY 21 Estimate uses actual data from 2017 and 2018.  2019 is av of 2016-2018
# Set 2019 Data of Record
rec19 <- mon_16_18 %>%
mutate(year = 2019) %>%
subset(select = c(-II_Q, -Sani_Q))
ww_FY21_est19 <- II_2016_2019 %>%
filter(meas %in% m_type[c(10,1)],
year >= 2017,
year <= 2018,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
rbind (rec19) %>%
group_by(community, month) %>%
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "17-19") %>%
ungroup() %>%
left_join(Sani_17_19, by = c("community", "month", "year")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
mutate(FY = "FY21",
actual = F)
# #Baseline Estimate
rec20 <- mon_17_19 %>%
mutate(year = 2020) %>%
subset(select = c(-II_Q, -Sani_Q))
ww_FY22_est20 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
#Tag this Estimate with FY and Estimate identifiers
mutate(FY = "FY22",
CY20_meth = "3yr ave (2017-19)",
actual = F)%>%
ungroup()
#Estimate w/ double weighting of CY19
rec20 <- II_2016_2019 %>%
filter(meas %in% m_type[c(10,1)],
year == 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
subset(select = -meas)%>%
rename(monthlyav = Q_MGD) %>%
rbind(rec20) %>%
rbind(rec20) %>%
rbind(rec20) %>%
group_by(community, month) %>%
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = 2020) %>%
ungroup()
ww_FY22_doub19 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
#Tag this Estimate with FY and Estimate identifiers
mutate(FY = "FY22",
CY20_meth = "3yr ave (2017-19)",
actual = F)%>%
ungroup()
#####Print Estimates to CSV
write_csv(rbind(ww_FY20_act,
ww_FY21_act,
ww_FY21_est19),
"BI_data/2019tests.csv")
write_csv(rbind(ww_FY22_est20,
ww_FY22_doub19),
"BI_data/2019Estimates.csv")
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
ww_FY22_doub19 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
#Tag this Estimate with FY and Estimate identifiers
mutate(FY = "FY22",
CY20_meth = "3yr ave (2017-19)",
actual = F)%>%
ungroup()
rec20 <- II_2016_2019 %>%
filter(meas %in% m_type[c(10,1)],
year == 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
subset(select = -meas)%>%
rename(monthlyav = Q_MGD) %>%
rbind(rec20) %>%
rbind(rec20) %>%
rbind(rec20) %>%
group_by(community, month) %>%
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = 2020) %>%
ungroup()
ww_FY22_doub19 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community) %>%
summarise(Sani_Q = mean(Sani_Q),
II_Q = mean(II_Q),
Assessment = mean(monthlyav),
max_month = month[monthlyav == max(monthlyav)],
max_MGD = max(monthlyav)) %>%
#Tag this Estimate with FY and Estimate identifiers
mutate(FY = "FY22",
CY20_meth = "3yr ave (2017-19)",
actual = F
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
ww_FY22_doub19 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20a)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community)
View(ww_FY22_doub19)
ww_FY22_doub19 <- II_2016_2019 %>%
#Filter out only final WW measurements
filter(meas %in% m_type[c(10,1)],
year >= 2018,
year <= 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
#Drop Measurement Name and rename Q_MGD
subset(select = -meas) %>%
rename(monthlyav = Q_MGD) %>%
#Add the 2020 estimate of record
rbind(rec20a)%>%
#group tbl by community and month
group_by(community, month) %>%
#Summarize the flow values to an average for months, add year range
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = "18-20") %>%
ungroup() %>%
#Add Sanitary flows over the same months and calculate teh I-I Flow
left_join(Sani_19, by = c("community", "month")) %>%
mutate( II_Q = monthlyav - Sani_Q)%>%
#Group by community and create a community monthly estimate
group_by(community)
max(ww_FY22_doub19$monthlyav)
ww_FY22_doub19
max(ww_FY22_doub19[]$monthlyav)
max(ww_FY22_doub19[1:43]$monthlyav)
max(ww_FY22_doub19$monthlyav[[43]])
max(ww_FY22_doub19$monthlyav[[1:43]])
max(ww_FY22_doub19$monthlyav[[]])
max(ww_FY22_doub19$monthlyav[])
max(ww_FY22_doub19$monthlyav[,])
max(ww_FY22_doub19$monthlyav[1])
max(ww_FY22_doub19$monthlyav[2])
max(ww_FY22_doub19$monthlyav[5])
max(ww_FY22_doub19$monthlyav[6])
max(ww_FY22_doub19$monthlyav[7])
max(ww_FY22_doub19$monthlyav[8])
max(ww_FY22_doub19$monthlyav[4])
max(ww_FY22_doub19$monthlyav[3])
for(i in 1:43){max(ww_FY22_doub19$monthlyav[i])}
for(i in 1:43){max(ww_FY22_doub19$monthlyav[i])}
for(i in 1:43){print(max(ww_FY22_doub19$monthlyav[i]))}
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/I-I_Estimates.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Estimate_funciton.R')
rec20a <- II_2016_2019 %>%
filter(meas %in% m_type[c(10,1)],
year == 2019,
month %in% month.abb,
community %in% FS_Sewer_towns) %>%
subset(select = -meas)%>%
rename(monthlyav = Q_MGD) %>%
rbind(rec20) %>%
rbind(rec20) %>%
rbind(rec20) %>%
group_by(community, month) %>%
summarise(monthlyav = mean(monthlyav)) %>%
mutate(year = 2020) %>%
ungroup()
ww_FY22_doub19 <- Build_Est(2018,2019, rec20a)
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Estimate_funciton.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Estimate_funciton.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Estimate_funciton.R')
View(Water_hist)
source('C:/Users/greeley_m/projects/Wastewater_Model/Estimate_funciton.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
View(ww_FY20_act)
View(ww_FY21_act)
View(ww_FY22_est20)
View(ww_FY22_doub19)
View(ww_FY21_est19)
rbind(ww_FY20_act,
ww_FY21_act,
ww_FY21_est19,
ww_FY22_est20,
ww_FY22_doub19)
View(ww_FY20_act)
View(ww_FY21_est19)
View(ww_FY21_act)
View(ww_FY21_est19)
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
View(Water_hist)
Water_hist %>%
filter(year == c(2017:2020))
Water_hist %>%
filter(year %in% c(2017:2020))
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020)) %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020])
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020)
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020])
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020)
month %in% "Apr")
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020])
View(WaterUse_factors)
View(Water_hist)
View(WaterUse_factors)
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/(mean(Q_MGD[year == 2017:2019])))
warnings()
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019])))
View(WaterUse_factors)
View(rec20)
View(Sani_19)
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019])))
WaterUse_factors$factor[is.na(WaterUse_factors$factor)] = 1
View(WaterUse_factors)
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019]))) %>%
mutate(factor = if_else (is.na(factor),1,factor))
View(WaterUse_factors)
View(WaterUse_factors)
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019]))) %>%
subset(select = c(-month))%>%
full_join(WW_towns)%>%
mutate(factor = if_else (is.na(factor),1,factor))
View(W_Towns)
View(WW_towns)
WaterUse_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019]))) %>%
subset(select = c(-month))%>%
mutate(factor = if_else (is.na(factor),1,factor))
View(rec20)
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19)
View(Sani_19)
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q[Sani_19$community = community])
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q[Sani_19$community == community &
Sani_19$month == month])
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q)
View(rec20W)
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q[Sani_19$community == community])
rec20W <- rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q[Sani_19$community == community &
Sani_19$month == month])
View(rec20)
View(Sani_19)
rec20 %>%
mutate(Sani_Q = Sani_19$Sani_Q[Sani_19$community == community &
Sani_19$month == month])
Sani_19$month
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
?left_join
rec20W <- rec20 %>%
left_join(Sani_19$Sani_Q, by = c("community", "month"))
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month"))
View(rec20W)
View(WaterUse_factors)
W_factors <- Water_hist %>%
filter(year %in% c(2017:2020),
month %in% "Apr") %>%
group_by(community, month) %>%
summarise(factor = Q_MGD[year == 2020]/
(mean(Q_MGD[year %in% 2017:2019]))) %>%
subset(select = c(-month))%>%
mutate(factor = if_else (is.na(factor),1,factor))
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(Sani_Q = Sani_Q*W_factors$factor)
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(Sani_Q = Sani_Q*W_factors$factor[community == community])
View(rec20W)
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[community == community])
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[community == community])
View(rec20W)
View(W_factors)
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[W$factors$community == rec20$community])
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[W_factors$community == rec20$community])
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[W_factors$community == community])
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
mutate(factor= W_factors$factor[W_factors$community %is% community])
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
left_join(W_factors, by = c("community"))
View(rec20W)
View(rec20W)
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
left_join(W_factors, by = c("community"))%>%
mutate(W_factors = if_else (is.na(W_factors),1,W_factors))
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
left_join(W_factors, by = c("community"))%>%
mutate(factor = if_else (is.na(factor),1,factor))
View(rec20W)
rec20W <- rec20 %>%
left_join(Sani_19, by = c("community", "month")) %>%
left_join(W_factors, by = c("community"))%>%
mutate(factor = if_else (is.na(factor),1,factor))%>%
mutate(monthlyav = monthlyav - (Sani_Q*(1-factor)))
View(rec20W)
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
source('C:/Users/greeley_m/projects/Wastewater_Model/Assessment_Model.R')
View(ww_FY22_water)
